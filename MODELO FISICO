/* LOGICO_VERSAOPOSAPRESENTACAO_FINAL: */

CREATE TABLE PESSOA (
    ID_PESSOA Serial PRIMARY KEY,
    NOME Varchar(50),
    DATA_NASCIMENTO date,
    SEXO Varchar(50)
);

CREATE TABLE CONTATO (
    ID_CONTATO Serial PRIMARY KEY,
    CONTATO Varchar(50),
    FK_PESSOA_ID_PESSOA Serial,
    FK_TIPO_CONTATO_ID_TIPO_CONTATO Serial
);

CREATE TABLE TIPO_CONTATO (
    ID_TIPO_CONTATO Serial PRIMARY KEY,
    TIPO_CONTATO Varchar(50)
);

CREATE TABLE VEICULO (
    PLACA Varchar(50),
    ID_VEICULO Serial PRIMARY KEY,
    FK_PESSOA_ID_PESSOA Serial,
    FK_MODELO_ID_MODELO Serial,
    FK_CATEGORIA_ID_CATEGORIA Serial
);

CREATE TABLE MECANICO (
    CNPJ Varchar(50),
    NOME_OFICINA Varchar(50),
    ESPECIALIZACAO Varchar(50),
    FK_PESSOA_ID_PESSOA Serial PRIMARY KEY
);

CREATE TABLE MOTORISTA (
    CNH Varchar(50),
    FK_PESSOA_ID_PESSOA Serial PRIMARY KEY
);

CREATE TABLE MODELO (
    ID_MODELO Serial PRIMARY KEY,
    MODELO_VEICULO Varchar(50),
    ANO_VEICULO Int,
    COR Varchar(50),
    FK_MARCA_ID_MARCA Serial
);

CREATE TABLE MARCA (
    ID_MARCA Serial PRIMARY KEY,
    MARCA Varchar(50)
);

CREATE TABLE CATEGORIA (
    ID_CATEGORIA Serial PRIMARY KEY,
    CATEGORIA Varchar(50)
);

CREATE TABLE SENSORES (
    ID_SENSOR Serial PRIMARY KEY,
    NOME_SENSOR Varchar(50),
    DESCRICAO Varchar(50),
    FK_VEICULO_ID_VEICULO Serial,
    FK_TIPO_SENSOR_ID_TIPO_SENSOR Serial
);

CREATE TABLE TIPO_SENSOR (
    ID_TIPO_SENSOR Serial PRIMARY KEY,
    TIPO_SENSOR Varchar(50)
);

CREATE TABLE HISTORICO (
    DATA_ANALISE date,
    HORA_ANALISE TIME,
    ID_HISTORICO Serial PRIMARY KEY
);

CREATE TABLE GERAM (
    FK_SENSORES_ID_SENSOR Serial,
    FK_HISTORICO_ID_HISTORICO Serial,
    ESTADO_PECA int,
    TIPO_DEFEITO varchar(50)
);

CREATE TABLE CONTRATA (
    FK_MOTORISTA_FK_PESSOA_ID_PESSOA Serial,
    FK_MECANICO_FK_PESSOA_ID_PESSOA Serial,
    HORA_CONTRATA TIME,
    DATA_CONTRATA date,
    ID_CONTRATA Serial PRIMARY KEY
);
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_2
    FOREIGN KEY (FK_PESSOA_ID_PESSOA)
    REFERENCES PESSOA (ID_PESSOA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_3
    FOREIGN KEY (FK_TIPO_CONTATO_ID_TIPO_CONTATO)
    REFERENCES TIPO_CONTATO (ID_TIPO_CONTATO)
    ON DELETE CASCADE ON UPDATE CASCADE;
 
ALTER TABLE VEICULO ADD CONSTRAINT FK_VEICULO_2
    FOREIGN KEY (FK_PESSOA_ID_PESSOA)
    REFERENCES PESSOA (ID_PESSOA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE VEICULO ADD CONSTRAINT FK_VEICULO_3
    FOREIGN KEY (FK_MODELO_ID_MODELO)
    REFERENCES MODELO (ID_MODELO)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE VEICULO ADD CONSTRAINT FK_VEICULO_4
    FOREIGN KEY (FK_CATEGORIA_ID_CATEGORIA)
    REFERENCES CATEGORIA (ID_CATEGORIA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE MECANICO ADD CONSTRAINT FK_MECANICO_2
    FOREIGN KEY (FK_PESSOA_ID_PESSOA)
    REFERENCES PESSOA (ID_PESSOA)
    ON DELETE CASCADE ON UPDATE CASCADE;
 
ALTER TABLE MOTORISTA ADD CONSTRAINT FK_MOTORISTA_2
    FOREIGN KEY (FK_PESSOA_ID_PESSOA)
    REFERENCES PESSOA (ID_PESSOA)
    ON DELETE CASCADE ON UPDATE CASCADE;
 
ALTER TABLE MODELO ADD CONSTRAINT FK_MODELO_2
    FOREIGN KEY (FK_MARCA_ID_MARCA)
    REFERENCES MARCA (ID_MARCA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE SENSORES ADD CONSTRAINT FK_SENSORES_2
    FOREIGN KEY (FK_VEICULO_ID_VEICULO)
    REFERENCES VEICULO (ID_VEICULO)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE SENSORES ADD CONSTRAINT FK_SENSORES_3
    FOREIGN KEY (FK_TIPO_SENSOR_ID_TIPO_SENSOR)
    REFERENCES TIPO_SENSOR (ID_TIPO_SENSOR)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE GERAM ADD CONSTRAINT FK_GERAM_1
    FOREIGN KEY (FK_SENSORES_ID_SENSOR)
    REFERENCES SENSORES (ID_SENSOR)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE GERAM ADD CONSTRAINT FK_GERAM_2
    FOREIGN KEY (FK_HISTORICO_ID_HISTORICO)
    REFERENCES HISTORICO (ID_HISTORICO)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE CONTRATA ADD CONSTRAINT FK_CONTRATA_2
    FOREIGN KEY (FK_MOTORISTA_FK_PESSOA_ID_PESSOA)
    REFERENCES MOTORISTA (FK_PESSOA_ID_PESSOA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
 
ALTER TABLE CONTRATA ADD CONSTRAINT FK_CONTRATA_3
    FOREIGN KEY (FK_MECANICO_FK_PESSOA_ID_PESSOA)
    REFERENCES MECANICO (FK_PESSOA_ID_PESSOA)
    ON DELETE RESTRICT ON UPDATE RESTRICT;